<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω Ng∆∞·ªùi t√¨m vi·ªác</title>
    <link rel="stylesheet" th:href="@{/CSS/jobseeker.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script>
        // L∆ØU √ù: Script trong <head> c√≥ th·ªÉ KH√îNG CH·∫†Y n·∫øu trang ƒë∆∞·ª£c load qua AJAX
        // T·∫•t c·∫£ logic ch√≠nh n·∫±m trong script ·ªü body (sau tag </div>)
        (function() {
            'use strict';
            console.log("üîß Script trong <head> ƒë√£ ƒë∆∞·ª£c load (n·∫øu b·∫°n th·∫•y log n√†y nghƒ©a l√† trang load tr·ª±c ti·∫øp)");

            // Ki·ªÉm tra context: ch·ªâ ho·∫°t ƒë·ªông khi ·ªü trang jobseeker
            function isJobSeekerPageHead() {
                return !!document.getElementById("searchInput") && 
                       !!document.querySelector(".jobseeker-management");
            }

            // H√†m √°p d·ª•ng filter (ƒë∆∞·ª£c g·ªçi t·ª´ onclick trong HTML)
            // CH·ªà HO·∫†T ƒê·ªòNG KHI ·ªû TRANG JOBSEEKER
            window.applyFilters = function() {
                if (!isJobSeekerPageHead()) {
                    return;
                }
                console.log("üîç applyFilters() ƒë∆∞·ª£c g·ªçi t·ª´ onclick");
                // L∆∞u √Ω: C√°c bi·∫øn searchInput, statusFilter, etc. ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong body script
                // Functions trong head ch·ªâ l√† fallback, logic ch√≠nh ·ªü body
                if (window.fetchJobSeekers) {
                    window.fetchJobSeekers();
                } else {
                    console.error("‚ùå fetchJobSeekers ch∆∞a ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a");
                }
            };
            
            // H√†m reset t·∫•t c·∫£ filter (ƒë∆∞·ª£c g·ªçi t·ª´ onclick trong HTML)
            // CH·ªà HO·∫†T ƒê·ªòNG KHI ·ªû TRANG JOBSEEKER
            window.resetFilters = function() {
                if (!isJobSeekerPageHead()) {
                    return;
                }
                console.log("üîÑ resetFilters() ƒë∆∞·ª£c g·ªçi");
                // L·∫•y elements n·∫øu c√≥
                const searchInputEl = document.getElementById("searchInput");
                const statusFilterEl = document.getElementById("statusFilter");
                const experienceFilterEl = document.getElementById("experienceFilter");
                if (searchInputEl) searchInputEl.value = "";
                if (statusFilterEl) statusFilterEl.value = "";
                if (experienceFilterEl) experienceFilterEl.value = "";
                if (window.fetchJobSeekers) {
                    window.fetchJobSeekers();
                } else {
                    console.error("‚ùå fetchJobSeekers ch∆∞a ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a");
                }
            };
            
            // ƒêƒÉng k√Ω event listener ngay khi DOM s·∫µn s√†ng
            // CH·ªà HO·∫†T ƒê·ªòNG KHI ·ªû TRANG JOBSEEKER
            window.initButtons = function() {
                if (!isJobSeekerPageHead()) {
                    return;
                }
                const filterBtn = document.getElementById("filterBtn");
                const resetFilterBtn = document.getElementById("resetFilterBtn");
                
                if (filterBtn) {
                    console.log("‚úÖ ƒêƒÉng k√Ω event listener cho n√∫t L·ªçc");
                    filterBtn.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log("üîç N√∫t L·ªçc ƒë∆∞·ª£c click");
                        window.applyFilters();
                        return false;
                    };
                }
                
                if (resetFilterBtn) {
                    console.log("‚úÖ ƒêƒÉng k√Ω event listener cho n√∫t X√≥a b·ªô l·ªçc");
                    resetFilterBtn.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log("üîÑ N√∫t X√≥a b·ªô l·ªçc ƒë∆∞·ª£c click");
                        window.resetFilters();
                        return false;
                    };
                }
            };
            
            // Th·ª≠ ƒëƒÉng k√Ω ngay n·∫øu DOM ƒë√£ s·∫µn s√†ng
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', window.initButtons);
            } else {
                // DOM ƒë√£ s·∫µn s√†ng
                window.initButtons();
            }
        })(); // ƒê√≥ng IIFE cho script trong head
    </script>
</head>

<body>
<div class="jobseeker-management">
    <!-- Header -->
    <div class="jobseeker-header">
        <h2 class="jobseeker-title"><i class="fas fa-user-tie"></i> T√†i kho·∫£n ng∆∞·ªùi t√¨m vi·ªác</h2>
        <div class="jobseeker-actions">
            <button type="button" class="btn btn-success" id="exportBtn" onclick="if(typeof window.exportToExcel === 'function') { window.exportToExcel(); } else { console.error('exportToExcel not found'); alert('Ch·ª©c nƒÉng xu·∫•t Excel ch∆∞a s·∫µn s√†ng'); } return false;">
                <i class="fas fa-download"></i> Xu·∫•t Excel
            </button>
        </div>
    </div>

    <!-- Filters -->
    <div class="jobseeker-filters">
        <div class="filter-row">
            <div class="filter-group">
                <label for="searchInput">T√¨m ki·∫øm</label>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm theo t√™n, email...">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            <div class="filter-group">
                <label for="statusFilter">Tr·∫°ng th√°i</label>
                <select id="statusFilter">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
                    <option value="locked">ƒê√£ kh√≥a</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="experienceFilter">Kinh nghi·ªám</label>
                <select id="experienceFilter">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="0">Ch∆∞a c√≥</option>
                    <option value="1">1 nƒÉm</option>
                    <option value="2">2 nƒÉm</option>
                    <option value="3">3+ nƒÉm</option>
                </select>
            </div>
            <div class="filter-group" style="display: flex; align-items: flex-end; gap: 10px; margin-left: 10px;">
                <button type="button" class="btn btn-primary" id="filterBtn" style="height: 38px; padding: 0 20px; cursor: pointer; border: none; background-color: #007bff; color: white; border-radius: 4px;">
                    <i class="fas fa-filter"></i> L·ªçc
                </button>
                <button type="button" class="btn btn-secondary" id="resetFilterBtn" style="height: 38px; padding: 0 20px; cursor: pointer; border: none; background-color: #6c757d; color: white; border-radius: 4px;">
                    <i class="fas fa-redo"></i> X√≥a b·ªô l·ªçc
                </button>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="jobseeker-stats">
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-users"></i></div>
            <div class="stat-info">
                <h3 th:text="${totalJobSeekers}">0</h3>
                <p>T·ªïng s·ªë ng∆∞·ªùi t√¨m vi·ªác</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon active"><i class="fas fa-user-check"></i></div>
            <div class="stat-info">
                <h3 th:text="${activeJobSeekers}">0</h3>
                <p>ƒêang ho·∫°t ƒë·ªông</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon inactive"><i class="fas fa-user-lock"></i></div>
            <div class="stat-info">
                <h3 th:text="${lockedJobSeekers}">0</h3>
                <p>ƒê√£ kh√≥a</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-file-alt"></i></div>
            <div class="stat-info">
                <h3 th:text="${totalCVs}">0</h3>
                <p>CV ƒë√£ t·∫°o</p>
            </div>
        </div>
    </div>

    <!-- Job Seeker Table -->
    <div class="jobseeker-table-container">
        <table class="jobseeker-table">
            <thead>
            <tr>
                <th>ID</th>
                <th>H·ªç v√† t√™n</th>
                <th>Email</th>
                <th>Gi·ªõi t√≠nh</th>
                <th>ƒê·ªãa ch·ªâ</th>
                <th>Kinh nghi·ªám</th>
                <th>V·ªã tr√≠</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Ng√†y c·∫≠p nh·∫≠t</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
            </thead>

            <tbody>
            <tr th:if="${#lists.isEmpty(jobSeekers)}">
                <td colspan="10" style="text-align:center; padding:20px; color:#888;">
                    Kh√¥ng c√≥ d·ªØ li·ªáu
                </td>
            </tr>

            <tr th:each="j : ${jobSeekers}">
                <td th:text="${j.seekerId}"></td>
                <td th:text="${j.fullName}"></td>
                <td th:text="${j.email}"></td>
                <td th:text="${j.gender}"></td>
                <td th:text="${j.address}"></td>
                <td th:text="${j.experienceYears} + ' nƒÉm'"></td>
                <td th:text="${j.headline}"></td>
                <td>
                    <span th:text="${j.isLocked == false and j.receiveInvitations == true} ? 'ƒêang ho·∫°t ƒë·ªông' : 'ƒê√£ kh√≥a'"
                          th:classappend="${j.isLocked == false and j.receiveInvitations == true} ? 'status-active' : 'status-locked'"></span>
                </td>
                <td th:text="${#temporals.format(j.updatedAt, 'yyyy-MM-dd')}"></td>
                <td>
                    <!-- N√∫t x√≥a: disabled v√† x√°m m√†u n·∫øu ƒë√£ kh√≥a -->
                    <button th:if="${j.isLocked == false and j.receiveInvitations == true}"
                            class="btn btn-sm btn-danger"
                            onclick="if(typeof window.deleteJobSeeker === 'function') { window.deleteJobSeeker(this.getAttribute('data-seeker-id') || 0); } else { console.error('deleteJobSeeker not found'); alert('Ch·ª©c nƒÉng x√≥a ch∆∞a s·∫µn s√†ng'); } return false;"
                            th:attr="data-seeker-id=${j.seekerId}"
                            title="Kh√≥a t√†i kho·∫£n ng∆∞·ªùi t√¨m vi·ªác">
                        <i class="fas fa-trash-alt"></i> X√≥a
                    </button>
                    <button th:if="${j.isLocked == true or j.receiveInvitations == false}"
                            class="btn btn-sm btn-secondary"
                            disabled
                            style="cursor: not-allowed; opacity: 0.6;"
                            title="Kh√¥ng th·ªÉ x√≥a t√†i kho·∫£n ƒë√£ kh√≥a">
                        <i class="fas fa-trash-alt"></i> X√≥a
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="pagination">
        <div class="pagination-info" id="paginationInfo">
            Hi·ªÉn th·ªã <span id="fromIndex">1</span>-<span id="toIndex">5</span> c·ªßa <span id="totalResults">0</span> k·∫øt qu·∫£
        </div>
        <div class="pagination-controls" id="paginationControls">
            <button class="pagination-btn" id="prevBtn" disabled><i class="fas fa-chevron-left"></i></button>
            <div id="pageNumbers"></div>
            <button class="pagination-btn" id="nextBtn"><i class="fas fa-chevron-right"></i></button>
        </div>
    </div>
</div>
<script>
    // Wrap to√†n b·ªô code trong IIFE ƒë·ªÉ tr√°nh ·∫£nh h∆∞·ªüng ƒë·∫øn admin.html
    (function() {
        'use strict'; // Strict mode ƒë·ªÉ tr√°nh global leaks
        
        console.log("üîß ===== SCRIPT TRONG BODY JOBSEEKER ƒê√É ƒê∆Ø·ª¢C LOAD (ISOLATED SCOPE) =====");

        // Khai b√°o bi·∫øn trong local scope (kh√¥ng d√πng var global)
        let searchInput, statusFilter, experienceFilter, tbody;
        let searchTimeout;
        let currentPage = 1;
        let totalPages = 1;
        let totalResults = 0;
        const pageSize = 5;
        console.log("üîß ƒê√£ khai b√°o bi·∫øn local trong scope ri√™ng");

        // Ki·ªÉm tra context: ch·ªâ ho·∫°t ƒë·ªông khi ·ªü trang jobseeker
        function isJobSeekerPage() {
            return !!document.getElementById("searchInput") && 
                   !!document.querySelector(".jobseeker-management");
        }

    // ƒê·ªãnh nghƒ©a exportToExcel TR∆Ø·ªöC ƒë·ªÉ c√≥ th·ªÉ d√πng trong onclick c·ªßa HTML
    // CH·ªà HO·∫†T ƒê·ªòNG KHI ·ªû TRANG JOBSEEKER
    window.exportToExcel = function() {
        // Ki·ªÉm tra context tr∆∞·ªõc khi th·ª±c thi
        if (!isJobSeekerPage()) {
            console.warn("‚ö†Ô∏è exportToExcel ƒë∆∞·ª£c g·ªçi nh∆∞ng kh√¥ng ·ªü trang jobseeker");
            return;
        }
        
        console.log("üì• ===== exportToExcel() ƒê∆Ø·ª¢C G·ªåI (EARLY DEFINITION) =====");
        
        // L·∫•y l·∫°i elements n·∫øu ch∆∞a c√≥
        if (!searchInput || !statusFilter || !experienceFilter) {
            searchInput = document.getElementById("searchInput");
            statusFilter = document.getElementById("statusFilter");
            experienceFilter = document.getElementById("experienceFilter");
        }
        
        try {
            // L·∫•y gi√° tr·ªã filter hi·ªán t·∫°i
            const keyword = searchInput ? searchInput.value.trim() : "";
            const status = statusFilter ? statusFilter.value : "";
            const experience = experienceFilter ? experienceFilter.value : "";
            
            console.log("üìã Filter values:", { keyword, status, experience });
            
            // T·∫°o URL v·ªõi parameters
            const params = new URLSearchParams();
            if (keyword) params.append("keyword", keyword);
            if (status) params.append("status", status);
            if (experience) params.append("experience", experience);
            
            const url = `/admin/jobseeker/export${params.toString() ? '?' + params.toString() : ''}`;
            console.log("üîó URL export:", url);
            
            // M·ªü URL ƒë·ªÉ download file
            // S·ª≠ d·ª•ng window.location.href ƒë·ªÉ trigger download
            window.location.href = url;
            console.log("‚úÖ ƒê√£ redirect ƒë·∫øn URL export");
        } catch (error) {
            console.error("‚ùå L·ªói khi x·ª≠ l√Ω export:", error);
            alert("L·ªói khi xu·∫•t Excel: " + error.message);
        }
    };
    console.log("‚úÖ ƒê√£ ƒë·ªãnh nghƒ©a exportToExcel s·ªõm trong global scope");

    // ƒê·ªãnh nghƒ©a applyFilters v√† resetFilters ngay l·∫≠p t·ª©c
    // CH·ªà HO·∫†T ƒê·ªòNG KHI ·ªû TRANG JOBSEEKER
    window.applyFilters = function() {
        // Ki·ªÉm tra context tr∆∞·ªõc khi th·ª±c thi
        if (!isJobSeekerPage()) {
            return;
        }
        console.log("üîç applyFilters() ƒë∆∞·ª£c g·ªçi");
        if (!searchInput || !statusFilter || !experienceFilter) {
            searchInput = document.getElementById("searchInput");
            statusFilter = document.getElementById("statusFilter");
            experienceFilter = document.getElementById("experienceFilter");
            tbody = document.querySelector(".jobseeker-table tbody");
        }
        currentPage = 1; // Reset v·ªÅ trang 1 khi apply filter m·ªõi
        clearTimeout(searchTimeout);
        if (window.fetchJobSeekers) {
            window.fetchJobSeekers();
        } else {
            console.error("‚ùå fetchJobSeekers ch∆∞a ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a");
        }
    };

    window.resetFilters = function() {
        // Ki·ªÉm tra context tr∆∞·ªõc khi th·ª±c thi
        if (!isJobSeekerPage()) {
            return;
        }
        console.log("üîÑ resetFilters() ƒë∆∞·ª£c g·ªçi");
        if (!searchInput || !statusFilter || !experienceFilter) {
            searchInput = document.getElementById("searchInput");
            statusFilter = document.getElementById("statusFilter");
            experienceFilter = document.getElementById("experienceFilter");
            tbody = document.querySelector(".jobseeker-table tbody");
        }
        if (searchInput) searchInput.value = "";
        if (statusFilter) statusFilter.value = "";
        if (experienceFilter) experienceFilter.value = "";
        currentPage = 1; // Reset v·ªÅ trang 1 khi reset filter
        clearTimeout(searchTimeout);
        if (window.fetchJobSeekers) {
            window.fetchJobSeekers();
        }
    };

    console.log("‚úÖ ƒê√£ ƒë·ªãnh nghƒ©a applyFilters v√† resetFilters");

    // H√†m fetchJobSeekers - ph·∫£i ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr∆∞·ªõc
    // CH·ªà HO·∫†T ƒê·ªòNG KHI ·ªû TRANG JOBSEEKER
    window.fetchJobSeekers = async function() {
        // Ki·ªÉm tra context tr∆∞·ªõc khi th·ª±c thi
        if (!isJobSeekerPage()) {
            console.warn("‚ö†Ô∏è fetchJobSeekers ƒë∆∞·ª£c g·ªçi nh∆∞ng kh√¥ng ·ªü trang jobseeker");
            return;
        }
        console.log("üöÄ ===== fetchJobSeekers() ƒê∆Ø·ª¢C G·ªåI =====");

        // N·∫øu ch∆∞a c√≥ elements, th·ª≠ l·∫•y l·∫°i
        if (!searchInput) searchInput = document.getElementById("searchInput");
        if (!statusFilter) statusFilter = document.getElementById("statusFilter");
        if (!experienceFilter) experienceFilter = document.getElementById("experienceFilter");
        if (!tbody) tbody = document.querySelector(".jobseeker-table tbody");

        // Ki·ªÉm tra l·∫°i c√°c element
        if (!searchInput || !statusFilter || !experienceFilter) {
            console.error("‚ùå Thi·∫øu m·ªôt s·ªë element:", {
                searchInput: !!searchInput,
                statusFilter: !!statusFilter,
                experienceFilter: !!experienceFilter
            });
            return;
        }

            const keyword = searchInput.value.trim();
            const status = statusFilter.value;
            const experience = experienceFilter.value;

        console.log("üìã Filter values:", { keyword, status, experience });

            const params = new URLSearchParams();
        // Ch·ªâ append n·∫øu c√≥ gi√° tr·ªã (kh√¥ng append empty string)
            if (keyword) params.append("keyword", keyword);
            if (status) params.append("status", status);
            if (experience) params.append("experience", experience);
            params.append("page", currentPage);
            params.append("size", pageSize);

        const url = `/admin/jobseeker/search?${params.toString()}`;
        console.log("üîç ƒêang t√¨m ki·∫øm:", url);

        // Hi·ªÉn th·ªã loading
        if (tbody) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="10" style="text-align:center; padding:20px; color:#888;">
                        <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i d·ªØ li·ªáu...
                    </td>
                </tr>
            `;
        }

        try {
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            });

            console.log("üì° Response status:", response.status);

            if (!response.ok) {
                const errorText = await response.text();
                console.error("‚ùå L·ªói response:", errorText);
                throw new Error(`HTTP ${response.status}: ${errorText || 'Unknown error'}`);
            }

            const contentType = response.headers.get("content-type");
            if (!contentType || !contentType.includes("application/json")) {
                const text = await response.text();
                console.error("‚ùå Response kh√¥ng ph·∫£i JSON:", text.substring(0, 200));
                throw new Error("Server tr·∫£ v·ªÅ d·ªØ li·ªáu kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng JSON");
            }

            const responseData = await response.json();
            console.log("‚úÖ Nh·∫≠n ƒë∆∞·ª£c data:", responseData);

            // Backend tr·∫£ v·ªÅ object v·ªõi structure: { data: [...], total: ..., page: ..., totalPages: ... }
            let jobSeekers = [];
            if (Array.isArray(responseData)) {
                // N·∫øu response l√† array (backward compatibility)
                jobSeekers = responseData;
                totalResults = jobSeekers.length;
                totalPages = 1;
            } else if (responseData.data && Array.isArray(responseData.data)) {
                // N·∫øu response l√† object c√≥ property 'data'
                jobSeekers = responseData.data;
                totalResults = responseData.total || jobSeekers.length;
                currentPage = responseData.page || 1;
                totalPages = responseData.totalPages || 1;
            }

            console.log("‚úÖ S·ªë l∆∞·ª£ng k·∫øt qu·∫£:", jobSeekers.length, "Trang:", currentPage, "/", totalPages);

            if (jobSeekers.length === 0) {
                console.log("‚ÑπÔ∏è Kh√¥ng c√≥ d·ªØ li·ªáu ph√π h·ª£p v·ªõi filter hi·ªán t·∫°i");
            }

            window.renderTable(jobSeekers);
            window.renderPagination();
            // C·∫≠p nh·∫≠t th·ªëng k√™ sau khi render table
            if (typeof window.updateStats === 'function') {
                window.updateStats();
            }
            } catch (error) {
            console.error("‚ùå L·ªói khi g·ªçi API:", error);
            console.error("‚ùå Error stack:", error.stack);
            if (tbody) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align:center; padding:20px; color:#dc3545;">
                            <i class="fas fa-exclamation-triangle"></i> L·ªói khi t·∫£i d·ªØ li·ªáu: ${error.message}
                            <br><small>Vui l√≤ng m·ªü Console (F12) ƒë·ªÉ xem chi ti·∫øt</small>
                            <br><small>URL: ${url}</small>
                        </td>
                    </tr>
                `;
            }
        }
    }


    // H√†m render table
    window.renderTable = function(jobSeekers) {
        if (!tbody) {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y tbody");
            return;
        }

        tbody.innerHTML = "";

            if (!jobSeekers || jobSeekers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align:center; padding:20px; color:#888;">
                        Kh√¥ng c√≥ d·ªØ li·ªáu ph√π h·ª£p
                        </td>
                    </tr>
                `;
                return;
            }

            jobSeekers.forEach(j => {
            const isActive = j.isLocked === false && j.receiveInvitations === true;
            const statusText = isActive ? "ƒêang ho·∫°t ƒë·ªông" : "ƒê√£ kh√≥a";
            const statusClass = isActive ? "status-active" : "status-locked";
                const updated = j.updatedAt ? j.updatedAt.split("T")[0] : "";

            // X√°c ƒë·ªãnh n√∫t x√≥a c√≥ ƒë∆∞·ª£c disable kh√¥ng
            const isDisabled = !isActive; // N·∫øu ƒë√£ kh√≥a th√¨ disable
            const deleteBtnClass = isDisabled ? "btn btn-sm btn-secondary" : "btn btn-sm btn-danger";
            const deleteBtnStyle = isDisabled ? "cursor: not-allowed; opacity: 0.6;" : "";
            const deleteBtnDisabled = isDisabled ? "disabled" : "";
            const deleteOnclick = isDisabled ? "return false;" : `if(typeof window.deleteJobSeeker === 'function') { window.deleteJobSeeker(${j.seekerId || 0}); } else { console.error('deleteJobSeeker not found'); alert('Ch·ª©c nƒÉng x√≥a ch∆∞a s·∫µn s√†ng'); } return false;`;

            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${j.seekerId || ""}</td>
                        <td>${j.fullName || ""}</td>
                        <td>${j.email || ""}</td>
                        <td>${j.gender || ""}</td>
                        <td>${j.address || ""}</td>
                        <td>${j.experienceYears || 0} nƒÉm</td>
                        <td>${j.headline || ""}</td>
                        <td><span class="${statusClass}">${statusText}</span></td>
                        <td>${updated}</td>
                <td>
                    <button class="${deleteBtnClass}" ${deleteBtnDisabled} style="${deleteBtnStyle}" onclick="${deleteOnclick}" title="${isDisabled ? 'Kh√¥ng th·ªÉ x√≥a t√†i kho·∫£n ƒë√£ kh√≥a' : 'Kh√≥a t√†i kho·∫£n ng∆∞·ªùi t√¨m vi·ªác'}">
                        <i class="fas fa-trash-alt"></i> X√≥a
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        });

        console.log("‚úÖ ƒê√£ hi·ªÉn th·ªã", jobSeekers.length, "b·∫£n ghi");
    }

    // H√†m render pagination
    window.renderPagination = function() {
        const paginationInfo = document.getElementById("paginationInfo");
        const paginationControls = document.getElementById("paginationControls");
        const pageNumbers = document.getElementById("pageNumbers");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        if (!paginationInfo || !paginationControls) {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y pagination elements");
            return;
        }

        // C·∫≠p nh·∫≠t th√¥ng tin pagination
        const fromIndex = totalResults > 0 ? (currentPage - 1) * pageSize + 1 : 0;
        const toIndex = Math.min(currentPage * pageSize, totalResults);
        
        const fromIndexEl = document.getElementById("fromIndex");
        const toIndexEl = document.getElementById("toIndex");
        const totalResultsEl = document.getElementById("totalResults");
        
        if (fromIndexEl) fromIndexEl.textContent = fromIndex;
        if (toIndexEl) toIndexEl.textContent = toIndex;
        if (totalResultsEl) totalResultsEl.textContent = totalResults;

        // C·∫≠p nh·∫≠t n√∫t Previous/Next
        if (prevBtn) {
            prevBtn.disabled = currentPage <= 1;
            prevBtn.onclick = currentPage > 1 ? function() {
                currentPage--;
                window.fetchJobSeekers();
            } : null;
        }

        if (nextBtn) {
            nextBtn.disabled = currentPage >= totalPages;
            nextBtn.onclick = currentPage < totalPages ? function() {
                currentPage++;
                window.fetchJobSeekers();
            } : null;
        }

        // Render s·ªë trang
        if (!pageNumbers) {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y pageNumbers");
            return;
        }

        pageNumbers.innerHTML = "";

        if (totalPages <= 1) {
            // Ch·ªâ hi·ªÉn th·ªã trang 1 n·∫øu ch·ªâ c√≥ 1 trang
            const btn = document.createElement("button");
            btn.className = "pagination-btn active";
            btn.textContent = "1";
            btn.disabled = true;
            pageNumbers.appendChild(btn);
            return;
        }

        // Hi·ªÉn th·ªã t·ªëi ƒëa 7 n√∫t (bao g·ªìm ...)
        let startPage, endPage;
        
        if (totalPages <= 7) {
            // N·∫øu √≠t h∆°n 7 trang, hi·ªÉn th·ªã t·∫•t c·∫£
            startPage = 1;
            endPage = totalPages;
        } else {
            // N·∫øu nhi·ªÅu h∆°n 7 trang
            if (currentPage <= 4) {
                startPage = 1;
                endPage = 5;
            } else if (currentPage >= totalPages - 3) {
                startPage = totalPages - 4;
                endPage = totalPages;
            } else {
                startPage = currentPage - 2;
                endPage = currentPage + 2;
            }
        }

        // N√∫t ƒë·∫ßu ti√™n
        if (startPage > 1) {
            const btn = document.createElement("button");
            btn.className = "pagination-btn";
            btn.textContent = "1";
            btn.onclick = function() {
                currentPage = 1;
                window.fetchJobSeekers();
            };
            pageNumbers.appendChild(btn);
            
            if (startPage > 2) {
                const dots = document.createElement("button");
                dots.className = "pagination-btn";
                dots.textContent = "...";
                dots.disabled = true;
                dots.style.cursor = "default";
                pageNumbers.appendChild(dots);
            }
        }

        // C√°c n√∫t trang
        for (let i = startPage; i <= endPage; i++) {
            const btn = document.createElement("button");
            btn.className = "pagination-btn";
            if (i === currentPage) {
                btn.classList.add("active");
            }
            btn.textContent = i;
            btn.onclick = function() {
                currentPage = i;
                window.fetchJobSeekers();
            };
            pageNumbers.appendChild(btn);
        }

        // N√∫t cu·ªëi c√πng
        if (endPage < totalPages) {
            if (endPage < totalPages - 1) {
                const dots = document.createElement("button");
                dots.className = "pagination-btn";
                dots.textContent = "...";
                dots.disabled = true;
                dots.style.cursor = "default";
                pageNumbers.appendChild(dots);
            }
            
            const btn = document.createElement("button");
            btn.className = "pagination-btn";
            btn.textContent = totalPages;
            btn.onclick = function() {
                currentPage = totalPages;
                window.fetchJobSeekers();
            };
            pageNumbers.appendChild(btn);
        }
    }

    // H√†m x√≥a m·ªÅm job seeker (chuy·ªÉn sang tr·∫°ng th√°i ƒë√£ kh√≥a) - ƒê·ªäNH NGHƒ®A ·ªû GLOBAL SCOPE
    // CH·ªà HO·∫†T ƒê·ªòNG KHI ·ªû TRANG JOBSEEKER
    window.deleteJobSeeker = async function(seekerId) {
        // Ki·ªÉm tra context tr∆∞·ªõc khi th·ª±c thi
        if (!isJobSeekerPage()) {
            console.warn("‚ö†Ô∏è deleteJobSeeker ƒë∆∞·ª£c g·ªçi nh∆∞ng kh√¥ng ·ªü trang jobseeker");
            return;
        }
        console.log("üóëÔ∏è ===== deleteJobSeeker() ƒê∆Ø·ª¢C G·ªåI v·ªõi seekerId:", seekerId);
        
        if (!seekerId || seekerId === 0) {
            console.error("‚ùå Invalid seekerId:", seekerId);
            alert("‚ùå ID kh√¥ng h·ª£p l·ªá");
            return;
        }

        if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën kh√≥a t√†i kho·∫£n ng∆∞·ªùi t√¨m vi·ªác n√†y?\n\nT√†i kho·∫£n s·∫Ω chuy·ªÉn t·ª´ 'ƒêang ho·∫°t ƒë·ªông' sang 'ƒê√£ kh√≥a'.")) {
            console.log("‚ùå User ƒë√£ cancel");
            return;
        }

        console.log("üóëÔ∏è ƒêang x√≥a m·ªÅm job seeker:", seekerId);

        try {
            const response = await fetch(`/admin/jobseeker/${seekerId}`, {
                method: 'DELETE',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            });

            console.log("üì° Response status:", response.status);

            if (!response.ok) {
                const errorText = await response.text();
                console.error("‚ùå L·ªói response:", errorText);
                throw new Error(`HTTP ${response.status}: ${errorText || 'Unknown error'}`);
            }

            const result = await response.json();
            console.log("üì° Response delete:", result);

            if (result.success) {
                alert("‚úÖ " + result.message);
                // Refresh l·∫°i danh s√°ch v√† th·ªëng k√™
                console.log("üîÑ ƒêang refresh l·∫°i danh s√°ch v√† th·ªëng k√™ sau khi x√≥a m·ªÅm...");
                // C·∫≠p nh·∫≠t th·ªëng k√™ tr∆∞·ªõc
                if (typeof window.updateStats === 'function') {
                    console.log("üìä G·ªçi updateStats()...");
                    await window.updateStats();
                }
                // Sau ƒë√≥ refresh danh s√°ch
                if (typeof window.fetchJobSeekers === 'function') {
                    console.log("üîÑ G·ªçi fetchJobSeekers()...");
                    window.fetchJobSeekers();
                }
            } else {
                alert("‚ùå " + result.message);
            }
        } catch (error) {
            console.error("‚ùå L·ªói khi x√≥a m·ªÅm:", error);
            console.error("‚ùå Error stack:", error.stack);
            alert("‚ùå L·ªói khi kh√≥a t√†i kho·∫£n. Vui l√≤ng th·ª≠ l·∫°i.\n\n" + error.message);
        }
    };
    console.log("‚úÖ ƒê√£ ƒë·ªãnh nghƒ©a deleteJobSeeker trong global scope");

    // exportToExcel ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a s·ªõm ·ªü tr√™n, kh√¥ng c·∫ßn ƒë·ªãnh nghƒ©a l·∫°i

    // H√†m c·∫≠p nh·∫≠t th·ªëng k√™
    // CH·ªà HO·∫†T ƒê·ªòNG KHI ·ªû TRANG JOBSEEKER
    window.updateStats = async function() {
        // Ki·ªÉm tra context tr∆∞·ªõc khi th·ª±c thi
        if (!isJobSeekerPage()) {
            console.warn("‚ö†Ô∏è updateStats ƒë∆∞·ª£c g·ªçi nh∆∞ng kh√¥ng ·ªü trang jobseeker");
            return;
        }
        try {
            console.log("üìä ===== ƒêang c·∫≠p nh·∫≠t th·ªëng k√™ =====");
            const response = await fetch("/admin/api/jobseekers/stats", {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            });
            
            console.log("üì° Stats response status:", response.status);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            const data = await response.json();
            console.log("üìä Nh·∫≠n ƒë∆∞·ª£c th·ªëng k√™ t·ª´ API:", data);

            // T√¨m c√°c ph·∫ßn t·ª≠ th·ªëng k√™ - s·ª≠ d·ª•ng nhi·ªÅu c√°ch ƒë·ªÉ ƒë·∫£m b·∫£o t√¨m ƒë∆∞·ª£c
            const jobSeekerStats = document.querySelector(".jobseeker-stats");
            console.log("üîç T√¨m .jobseeker-stats:", !!jobSeekerStats);
            
            // C√°ch 1: T√¨m t·∫•t c·∫£ stat cards trong jobseeker-stats
            const statCards = jobSeekerStats ? jobSeekerStats.querySelectorAll(".stat-card") : 
                             document.querySelectorAll(".jobseeker-stats .stat-card");
            console.log("üîç T√¨m th·∫•y", statCards.length, "stat cards");
            
            // Log t·ª´ng card ƒë·ªÉ debug
            statCards.forEach((card, index) => {
                const h3 = card.querySelector("h3");
                const p = card.querySelector("p");
                console.log(`üìä Card ${index}:`, {
                    hasH3: !!h3,
                    currentText: h3 ? h3.textContent : 'N/A',
                    description: p ? p.textContent : 'N/A'
                });
            });
            
            if (statCards.length >= 4) {
                // Card 0: T·ªïng s·ªë
                const totalH3 = statCards[0].querySelector("h3");
                if (totalH3) {
                    const oldValue = totalH3.textContent;
                    totalH3.textContent = data.total || 0;
                    console.log(`‚úÖ C·∫≠p nh·∫≠t t·ªïng s·ªë: ${oldValue} -> ${data.total}`);
                } else {
                    console.error("‚ùå Kh√¥ng t√¨m th·∫•y h3 trong card 0 (T·ªïng s·ªë)");
                }
                
                // Card 1: ƒêang ho·∫°t ƒë·ªông
                const activeH3 = statCards[1].querySelector("h3");
                if (activeH3) {
                    const oldValue = activeH3.textContent.trim();
                    const newValue = String(data.active || 0);
                    
                    // X√≥a th:text attribute n·∫øu c√≥ (Thymeleaf c√≥ th·ªÉ gi·ªØ gi√° tr·ªã c≈©)
                    activeH3.removeAttribute("th:text");
                    
                    // C·∫≠p nh·∫≠t b·∫±ng nhi·ªÅu c√°ch
                    activeH3.textContent = newValue;
                    activeH3.innerText = newValue;
                    
                    // N·∫øu v·∫´n kh√¥ng ho·∫°t ƒë·ªông, th·ª≠ innerHTML
                    if (activeH3.textContent.trim() !== newValue) {
                        console.warn("‚ö†Ô∏è textContent kh√¥ng kh·ªõp, th·ª≠ innerHTML...");
                        activeH3.innerHTML = newValue;
                    }
                    
                    console.log(`‚úÖ C·∫≠p nh·∫≠t ƒëang ho·∫°t ƒë·ªông: '${oldValue}' -> '${newValue}'`);
                    console.log(`üîç Verify: activeH3.textContent = '${activeH3.textContent}', innerText = '${activeH3.innerText}'`);
                } else {
                    console.error("‚ùå Kh√¥ng t√¨m th·∫•y h3 trong card 1 (ƒêang ho·∫°t ƒë·ªông)");
                }
                
                // Card 2: ƒê√£ kh√≥a
                const lockedH3 = statCards[2].querySelector("h3");
                if (lockedH3) {
                    const oldValue = lockedH3.textContent.trim();
                    const newValue = String(data.locked || 0);
                    
                    // X√≥a th:text attribute n·∫øu c√≥ (Thymeleaf c√≥ th·ªÉ gi·ªØ gi√° tr·ªã c≈©)
                    lockedH3.removeAttribute("th:text");
                    
                    // C·∫≠p nh·∫≠t b·∫±ng nhi·ªÅu c√°ch
                    lockedH3.textContent = newValue;
                    lockedH3.innerText = newValue;
                    
                    // N·∫øu v·∫´n kh√¥ng ho·∫°t ƒë·ªông, th·ª≠ innerHTML
                    if (lockedH3.textContent.trim() !== newValue) {
                        console.warn("‚ö†Ô∏è textContent kh√¥ng kh·ªõp, th·ª≠ innerHTML...");
                        lockedH3.innerHTML = newValue;
                    }
                    
                    console.log(`‚úÖ C·∫≠p nh·∫≠t ƒë√£ kh√≥a: '${oldValue}' -> '${newValue}'`);
                    console.log(`üîç Verify: lockedH3.textContent = '${lockedH3.textContent}', innerText = '${lockedH3.innerText}'`);
                } else {
                    console.error("‚ùå Kh√¥ng t√¨m th·∫•y h3 trong card 2 (ƒê√£ kh√≥a)");
                }
                
                // Card 3: CV ƒë√£ t·∫°o
                const cvH3 = statCards[3].querySelector("h3");
                if (cvH3) {
                    const oldValue = cvH3.textContent;
                    cvH3.textContent = data.cv || 0;
                    console.log(`‚úÖ C·∫≠p nh·∫≠t CV: ${oldValue} -> ${data.cv}`);
                } else {
                    console.error("‚ùå Kh√¥ng t√¨m th·∫•y h3 trong card 3 (CV)");
                }
                
                console.log("‚úÖ ƒê√£ c·∫≠p nh·∫≠t t·∫•t c·∫£ th·ªëng k√™");
                
                // Verify l·∫°i sau khi c·∫≠p nh·∫≠t
                setTimeout(function() {
                    console.log("üîç Verify sau khi c·∫≠p nh·∫≠t:");
                    statCards.forEach((card, index) => {
                        const h3 = card.querySelector("h3");
                        const p = card.querySelector("p");
                        console.log(`üìä Card ${index} (${p ? p.textContent : 'N/A'}):`, h3 ? h3.textContent : 'N/A');
                    });
                }, 100);
            } else {
                console.error("‚ùå Kh√¥ng t√¨m th·∫•y ƒë·ªß stat cards (c·∫ßn 4, t√¨m th·∫•y " + statCards.length + ")");
                // Fallback: th·ª≠ t√¨m b·∫±ng selector c≈©
                const statH3s = document.querySelectorAll(".jobseeker-stats .stat-card h3");
                console.log("‚ö†Ô∏è Th·ª≠ fallback selector, t√¨m th·∫•y", statH3s.length, "h3 elements");
                if (statH3s.length >= 4) {
                    console.log("‚ö†Ô∏è S·ª≠ d·ª•ng fallback selector...");
                    statH3s[0].textContent = data.total || 0;
                    statH3s[1].textContent = data.active || 0;
                    statH3s[2].textContent = data.locked || 0;
                    statH3s[3].textContent = data.cv || 0;
                    console.log("‚úÖ ƒê√£ c·∫≠p nh·∫≠t b·∫±ng fallback selector");
                }
            }
        } catch (error) {
            console.error("‚ùå L·ªói khi c·∫≠p nh·∫≠t th·ªëng k√™:", error);
            console.error("‚ùå Error stack:", error.stack);
        }
    }

    // H√†m kh·ªüi t·∫°o trang jobseeker (g·ªçi l·∫°i m·ªói khi content ƒë∆∞·ª£c load)
    function initJobSeekerPage() {
        // Ki·ªÉm tra context: ch·ªâ ch·∫°y khi ·ªü trang jobseeker
        if (!isJobSeekerPage()) {
            console.warn("‚ö†Ô∏è initJobSeekerPage ƒë∆∞·ª£c g·ªçi nh∆∞ng kh√¥ng ·ªü trang jobseeker, b·ªè qua");
            return;
        }
        
        console.log("üìã Kh·ªüi t·∫°o trang jobseeker management");

        // L·∫•y l·∫°i elements
        searchInput = document.getElementById("searchInput");
        statusFilter = document.getElementById("statusFilter");
        experienceFilter = document.getElementById("experienceFilter");
        tbody = document.querySelector(".jobseeker-table tbody");
        const filterBtn = document.getElementById("filterBtn");
        const resetFilterBtn = document.getElementById("resetFilterBtn");
        const exportBtn = document.getElementById("exportBtn");

        // Ki·ªÉm tra c√°c element c√≥ t·ªìn t·∫°i kh√¥ng
        console.log("üîç Ki·ªÉm tra elements:", {
            searchInput: !!searchInput,
            statusFilter: !!statusFilter,
            experienceFilter: !!experienceFilter,
            tbody: !!tbody,
            filterBtn: !!filterBtn,
            resetFilterBtn: !!resetFilterBtn,
            exportBtn: !!exportBtn
        });

        if (!searchInput || !statusFilter || !experienceFilter || !tbody) {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y c√°c element c·∫ßn thi·∫øt");
            return;
        }

        // ƒê√£ x√≥a ch·∫ø ƒë·ªô t·ª± ƒë·ªông l·ªçc khi nh·∫≠p - ch·ªâ l·ªçc khi nh·∫•n n√∫t "L·ªçc"
        // C√≥ th·ªÉ gi·ªØ l·∫°i t√¨m ki·∫øm khi nh·∫•n Enter n·∫øu mu·ªën (t√πy ch·ªçn)
        if (searchInput) {
            // T√¨m ki·∫øm khi nh·∫•n Enter trong √¥ t√¨m ki·∫øm (t√πy ch·ªçn - c√≥ th·ªÉ x√≥a n·∫øu kh√¥ng c·∫ßn)
            searchInput.addEventListener("keypress", function(e) {
                if (e.key === "Enter") {
                    e.preventDefault();
                    clearTimeout(searchTimeout);
                    if (window.applyFilters) {
                        window.applyFilters();
                    }
                }
            });
        }

        // Ki·ªÉm tra l·∫°i buttons v√† ƒë·∫£m b·∫£o event listener ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω
        if (filterBtn) {
            console.log("‚úÖ N√∫t L·ªçc ƒë√£ t·ªìn t·∫°i, event listener ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω trong <head>");
        } else {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y n√∫t L·ªçc v·ªõi id='filterBtn'");
        }

        if (resetFilterBtn) {
            console.log("‚úÖ N√∫t X√≥a b·ªô l·ªçc ƒë√£ t·ªìn t·∫°i, event listener ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω trong <head>");
        } else {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y n√∫t X√≥a b·ªô l·ªçc v·ªõi id='resetFilterBtn'");
        }

        // ƒêƒÉng k√Ω event listener tr·ª±c ti·∫øp ·ªü ƒë√¢y ƒë·ªÉ ƒë·∫£m b·∫£o ho·∫°t ƒë·ªông
        console.log("üîß ƒêang ƒëƒÉng k√Ω event listener cho c√°c n√∫t...");

        if (filterBtn) {
            console.log("‚úÖ T√¨m th·∫•y n√∫t L·ªçc, ƒëƒÉng k√Ω onclick");
            // X√≥a event listener c≈© n·∫øu c√≥
            filterBtn.onclick = null;
            filterBtn.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log("üîç [BODY SCRIPT] N√∫t L·ªçc ƒë∆∞·ª£c click!");
                if (window.applyFilters) {
                    window.applyFilters();
                } else {
                    console.error("‚ùå window.applyFilters kh√¥ng t·ªìn t·∫°i!");
                    // G·ªçi tr·ª±c ti·∫øp
                    if (searchInput && statusFilter && experienceFilter) {
                        clearTimeout(searchTimeout);
                        window.fetchJobSeekers();
                    }
                }
                return false;
            };
            console.log("‚úÖ ƒê√£ ƒëƒÉng k√Ω onclick cho n√∫t L·ªçc");
        } else {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y n√∫t L·ªçc!");
        }

        if (resetFilterBtn) {
            console.log("‚úÖ T√¨m th·∫•y n√∫t X√≥a b·ªô l·ªçc, ƒëƒÉng k√Ω onclick");
            resetFilterBtn.onclick = null;
            resetFilterBtn.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log("üîÑ [BODY SCRIPT] N√∫t X√≥a b·ªô l·ªçc ƒë∆∞·ª£c click!");
                if (window.resetFilters) {
                    window.resetFilters();
                } else {
                    console.error("‚ùå window.resetFilters kh√¥ng t·ªìn t·∫°i!");
                    // G·ªçi tr·ª±c ti·∫øp
                    if (searchInput) searchInput.value = "";
                    if (statusFilter) statusFilter.value = "";
                    if (experienceFilter) experienceFilter.value = "";
                    clearTimeout(searchTimeout);
                    window.fetchJobSeekers();
                }
                return false;
            };
            console.log("‚úÖ ƒê√£ ƒëƒÉng k√Ω onclick cho n√∫t X√≥a b·ªô l·ªçc");
        } else {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y n√∫t X√≥a b·ªô l·ªçc!");
        }

        // G·ªçi l·∫°i initButtons t·ª´ head n·∫øu c√≥ (backup)
        if (typeof window.initButtons === 'function') {
            console.log("‚úÖ G·ªçi l·∫°i window.initButtons()");
            window.initButtons();
        } else {
            console.warn("‚ö†Ô∏è window.initButtons kh√¥ng t·ªìn t·∫°i (c√≥ th·ªÉ b√¨nh th∆∞·ªùng n·∫øu script trong head kh√¥ng ch·∫°y)");
        }

        // Dropdown filter - v·∫´n c√≥ th·ªÉ t·ª± ƒë·ªông filter n·∫øu mu·ªën
        // Ho·∫∑c comment l·∫°i n·∫øu mu·ªën ch·ªâ filter khi click n√∫t
        // if (statusFilter) {
        //     statusFilter.addEventListener("change", fetchJobSeekers);
        // }
        // if (experienceFilter) {
        //     experienceFilter.addEventListener("change", fetchJobSeekers);
        // }

        // deleteJobSeeker v√† exportToExcel ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a ·ªü global scope ·ªü tr√™n, kh√¥ng c·∫ßn ƒë·ªãnh nghƒ©a l·∫°i ·ªü ƒë√¢y

        // ƒêƒÉng k√Ω event listener cho n√∫t Xu·∫•t Excel (backup cho onclick inline)
        if (exportBtn) {
            console.log("‚úÖ T√¨m th·∫•y n√∫t Xu·∫•t Excel, ƒëƒÉng k√Ω event listener (backup)");
            
            // X√≥a onclick c≈© n·∫øu c√≥ (ƒë·ªÉ tr√°nh conflict)
            exportBtn.onclick = null;
            
            // ƒêƒÉng k√Ω onclick handler m·ªõi
            exportBtn.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log("üì• ===== [DOMContentLoaded onclick] N√öT XU·∫§T EXCEL ƒê∆Ø·ª¢C CLICK =====");
                console.log("üîç Ki·ªÉm tra window.exportToExcel:", typeof window.exportToExcel);
                if (typeof window.exportToExcel === 'function') {
                    console.log("‚úÖ G·ªçi window.exportToExcel()...");
                    window.exportToExcel();
                } else {
                    console.error("‚ùå window.exportToExcel kh√¥ng t·ªìn t·∫°i!");
                    alert("Ch·ª©c nƒÉng xu·∫•t Excel ch∆∞a s·∫µn s√†ng. Vui l√≤ng refresh trang.");
                }
                return false;
            };
            
            // Th√™m addEventListener backup
            exportBtn.addEventListener("click", function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log("üì• ===== [addEventListener] N√öT XU·∫§T EXCEL ƒê∆Ø·ª¢C CLICK =====");
                if (typeof window.exportToExcel === 'function') {
                    console.log("‚úÖ G·ªçi window.exportToExcel() t·ª´ addEventListener...");
                    window.exportToExcel();
                } else {
                    console.error("‚ùå window.exportToExcel kh√¥ng t·ªìn t·∫°i trong addEventListener!");
                }
                return false;
            });
            
            // Test: Ki·ªÉm tra onclick handler
            console.log("üß™ Test exportBtn:", {
                exists: !!exportBtn,
                hasOnclick: typeof exportBtn.onclick === 'function',
                onclickType: typeof exportBtn.onclick
            });
            
            console.log("‚úÖ ƒê√£ ƒëƒÉng k√Ω event listener cho n√∫t Xu·∫•t Excel");
        } else {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y n√∫t Xu·∫•t Excel v·ªõi id='exportBtn'");
        }

        // QUAN TR·ªåNG: X√≥a d·ªØ li·ªáu Thymeleaf ban ƒë·∫ßu ƒë·ªÉ tr√°nh buttons kh√¥ng ho·∫°t ƒë·ªông
        // V√¨ buttons ƒë∆∞·ª£c render b·ªüi Thymeleaf kh√¥ng c√≥ onclick handler
        if (tbody) {
            const existingRows = tbody.querySelectorAll("tr");
            if (existingRows.length > 0) {
                console.log("üßπ X√≥a", existingRows.length, "rows t·ª´ Thymeleaf ƒë·ªÉ tr√°nh buttons kh√¥ng ho·∫°t ƒë·ªông...");
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align:center; padding:20px; color:#888;">
                            <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i d·ªØ li·ªáu...
                        </td>
                    </tr>
                `;
            }
        }

        // T·ª± ƒë·ªông load d·ªØ li·ªáu khi trang ƒë∆∞·ª£c m·ªü
        console.log("üöÄ ƒêang t·∫£i d·ªØ li·ªáu ban ƒë·∫ßu...");
        // ƒê·∫£m b·∫£o fetchJobSeekers ƒë∆∞·ª£c g·ªçi ƒë·ªÉ render table v·ªõi buttons c√≥ onclick handler
        setTimeout(function() {
            if (typeof window.fetchJobSeekers === 'function') {
                console.log("‚úÖ fetchJobSeekers ƒë√£ s·∫µn s√†ng, g·ªçi ngay...");
                window.fetchJobSeekers();
            } else {
                console.error("‚ùå window.fetchJobSeekers ch∆∞a ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a!");
            }
        }, 100);
        
        window.updateStats();

        // Test: Ki·ªÉm tra xem c√°c n√∫t c√≥ th·ªÉ click ƒë∆∞·ª£c kh√¥ng
        console.log("üß™ Test buttons:", {
            filterBtnExists: !!filterBtn,
            filterBtnDisabled: filterBtn ? filterBtn.disabled : 'N/A',
            filterBtnStyle: filterBtn ? window.getComputedStyle(filterBtn).pointerEvents : 'N/A',
            resetFilterBtnExists: !!resetFilterBtn,
            resetFilterBtnDisabled: resetFilterBtn ? resetFilterBtn.disabled : 'N/A'
        });

        // ƒê·∫£m b·∫£o buttons kh√¥ng b·ªã disabled
        if (filterBtn) {
            filterBtn.disabled = false;
            filterBtn.style.pointerEvents = 'auto';
        }
        if (resetFilterBtn) {
            resetFilterBtn.disabled = false;
            resetFilterBtn.style.pointerEvents = 'auto';
        }
    }

    // Kh·ªüi t·∫°o khi DOM s·∫µn s√†ng (trang load tr·ª±c ti·∫øp)
    if (document.readyState === 'loading') {
        document.addEventListener("DOMContentLoaded", initJobSeekerPage);
    } else {
        // DOM ƒë√£ s·∫µn s√†ng
        setTimeout(initJobSeekerPage, 100);
    }

    // Event listener cho content ƒë∆∞·ª£c load qua AJAX
    // L·∫Øng nghe tr√™n contentArea ƒë·ªÉ re-initialize khi load l·∫°i
    (function() {
        // Ki·ªÉm tra xem c√≥ ƒëang ·ªü trang jobseeker kh√¥ng
        const searchInputCheck = document.getElementById("searchInput");
        if (!searchInputCheck) {
            // Kh√¥ng ph·∫£i trang jobseeker, kh√¥ng l·∫Øng nghe
            return;
        }
        
        const contentAreaEl = document.getElementById('content-area');
        if (contentAreaEl) {
            contentAreaEl.addEventListener('contentLoaded', function(e) {
                // Ki·ªÉm tra l·∫°i xem c√≥ ƒëang ·ªü trang jobseeker kh√¥ng
                const searchInputCheck2 = document.getElementById("searchInput");
                if (searchInputCheck2) {
                    // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ ƒë·∫£m b·∫£o DOM ƒë√£ update v√† scripts ƒë√£ ƒë∆∞·ª£c execute
                    setTimeout(function() {
                        console.log("üîÑ Re-initializing jobseeker page after AJAX load");
                        initJobSeekerPage();
                    }, 100);
                }
            });
        } else {
            // N·∫øu contentArea ch∆∞a t·ªìn t·∫°i, th·ª≠ l·∫°i sau
            setTimeout(function() {
                const area = document.getElementById('content-area');
                if (area) {
                    area.addEventListener('contentLoaded', function(e) {
                        const searchInputCheck2 = document.getElementById("searchInput");
                        if (searchInputCheck2) {
                            setTimeout(function() {
                                console.log("üîÑ Re-initializing jobseeker page after AJAX load (delayed)");
                                initJobSeekerPage();
                            }, 100);
                        }
                    });
                }
            }, 500);
        }
    })();
    
    })(); 
</script>
</body>
</html>
