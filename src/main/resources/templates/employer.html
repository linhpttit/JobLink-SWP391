<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω nh√† tuy·ªÉn d·ª•ng</title>
    <link rel="stylesheet" href="/CSS/employer.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="employer-management">
    <!-- Header -->
    <div class="employer-header">
        <h2 class="employer-title"><i class="fas fa-user-tie"></i>T√†i kho·∫£n nh√† tuy·ªÉn d·ª•ng</h2>
        <div class="employer-actions">
            <button class="btn btn-success" id="exportBtn" onclick="if(typeof window.exportEmployersToExcel === 'function') { window.exportEmployersToExcel(); } else { console.error('exportEmployersToExcel not found'); alert('Ch·ª©c nƒÉng xu·∫•t Excel ch∆∞a s·∫µn s√†ng'); } return false;">
                <i class="fas fa-download"></i> Xu·∫•t Excel
            </button>
        </div>
    </div>

    <!-- Filters -->
    <div class="employer-filters">
        <div class="filter-row">
            <div class="filter-group">
                <label for="keyword">T√¨m ki·∫øm</label>
                <div class="search-box">
                    <input type="text" id="keyword" name="keyword" 
                           th:value="${keyword}" 
                           placeholder="T√™n c√¥ng ty, email, ƒë·ªãa ch·ªâ...">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            <div class="filter-group">
                <label for="status">Tr·∫°ng th√°i</label>
                <select id="status" name="status">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="active" th:selected="${status == 'active'}">ƒêang ho·∫°t ƒë·ªông</option>
                    <option value="inactive" th:selected="${status == 'inactive'}">Ng·ª´ng ho·∫°t ƒë·ªông</option>
                    <option value="pending" th:selected="${status == 'pending'}">Ch·ªù x√©t duy·ªát</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="dateFilter">Ng√†y ƒëƒÉng k√Ω</label>
                <input type="date" id="dateFilter" name="dateFilter" th:value="${dateFilter}">
            </div>
            <div class="filter-group" style="display: flex; align-items: flex-end; gap: 10px; margin-left: 10px;">
                <button type="button" class="btn btn-primary" id="filterBtn" style="height: 38px; padding: 0 20px; cursor: pointer; border: none; background-color: #007bff; color: white; border-radius: 4px;">
                    <i class="fas fa-filter"></i> L·ªçc
                </button>
                <button type="button" class="btn btn-secondary" id="clearBtn" style="height: 38px; padding: 0 20px; cursor: pointer; border: none; background-color: #6c757d; color: white; border-radius: 4px;">
                    <i class="fas fa-redo"></i> X√≥a b·ªô l·ªçc
                </button>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="employer-stats">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-building"></i>
            </div>
            <div class="stat-info">
                <h3 th:text="${totalEmployers}">0</h3>
                <p>T·ªïng s·ªë nh√† tuy·ªÉn d·ª•ng</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon active">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
                <h3 th:text="${activeEmployers}">0</h3>
                <p>ƒêang ho·∫°t ƒë·ªông</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon pending">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
                <h3 th:text="${pendingEmployers}">0</h3>
                <p>Ch·ªù x√©t duy·ªát</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon inactive">
                <i class="fas fa-ban"></i>
            </div>
            <div class="stat-info">
                <h3 th:text="${inactiveEmployers}">0</h3>
                <p>Ng·ª´ng ho·∫°t ƒë·ªông</p>
            </div>
        </div>
    </div>

    <!-- Employer Table -->
    <div class="employer-table-container">
        <table class="employer-table">
            <thead>
            <tr>
                <th>C√¥ng ty</th>
                <th>Email</th>
                <th>ƒêi·ªán tho·∫°i</th>
                <th>Ng√†nh ngh·ªÅ</th>
                <th>ƒê·ªãa ch·ªâ</th>
                <th>Ng√†y ƒëƒÉng k√Ω</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Thao t√°c</th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${#lists.isEmpty(employers)}">
                <td colspan="8" style="text-align:center; padding: 20px; color: #888;">
                    Kh√¥ng c√≥ d·ªØ li·ªáu
                </td>
            </tr>

            <tr th:each="emp : ${employers}">
                <td th:text="${emp.companyName}"></td>
                <td th:text="${emp.email}"></td>
                <td th:text="${emp.phoneNumber}"></td>
                <td th:text="${emp.industry}"></td>
                <td th:text="${emp.location}"></td>
                <td th:text="${emp.createdAt != null ? #temporals.format(emp.createdAt, 'yyyy-MM-dd') : ''}"></td>
                <td>
                    <span th:if="${emp.status == 'pending'}"
                          class="status-pending" th:text="${emp.statusText}"></span>
                    <span th:if="${emp.status == 'active'}"
                          class="status-active" th:text="${emp.statusText}"></span>
                    <span th:if="${emp.status == 'inactive'}"
                          class="status-inactive" th:text="${emp.statusText}"></span>
                </td>
                <td>
                    <!-- N√∫t x√≥a: disabled v√† x√°m m√†u n·∫øu ƒë√£ kh√≥a -->
                    <button class="btn btn-sm btn-secondary" 
                            th:if="${emp.status == 'inactive'}"
                            disabled
                            style="cursor: not-allowed; opacity: 0.6;"
                            title="Kh√¥ng th·ªÉ x√≥a t√†i kho·∫£n ƒë√£ kh√≥a">
                        <i class="fas fa-trash-alt"></i> X√≥a
                    </button>
                    
                    <!-- Form x√≥a m·ªÅm cho employer ƒëang ho·∫°t ƒë·ªông -->
                    <form th:if="${emp.status == 'active' or emp.status == 'pending'}"
                          th:attr="data-action=@{/admin/employer/{userId}/soft-delete(userId=${emp.userId})}"
                          class="soft-delete-form"
                          style="display: inline-block;"
                          onsubmit="return window.softDeleteEmployer(event, this);">
                        <button type="submit" class="btn btn-sm btn-danger" title="Kh√≥a t√†i kho·∫£n nh√† tuy·ªÉn d·ª•ng">
                            <i class="fas fa-trash-alt"></i> X√≥a
                        </button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="pagination">
        <div class="pagination-info" id="paginationInfo">
            Hi·ªÉn th·ªã <span id="fromIndex">1</span>-<span id="toIndex">5</span> c·ªßa <span id="totalResults">0</span> k·∫øt qu·∫£
        </div>
        <div class="pagination-controls" id="paginationControls">
            <button class="pagination-btn" id="prevBtn" disabled><i class="fas fa-chevron-left"></i></button>
            <div id="pageNumbers"></div>
            <button class="pagination-btn" id="nextBtn"><i class="fas fa-chevron-right"></i></button>
        </div>
    </div>
</div>

 <script>
    // Bi·∫øn pagination
    let currentPage = 1;
    let totalPages = 1;
    let totalResults = 0;
    const pageSize = 5;

    // H√†m x√≥a m·ªÅm employer - ch·ªâ reload b·∫£ng d·ªØ li·ªáu
    window.softDeleteEmployer = async function(event, form) {
        event.preventDefault();
        
        if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën kh√≥a t√†i kho·∫£n n√†y? T√†i kho·∫£n s·∫Ω chuy·ªÉn sang tr·∫°ng th√°i Ng·ª´ng ho·∫°t ƒë·ªông.')) {
            return false;
        }
        
        const action = form.getAttribute('data-action');
        
        try {
            const response = await fetch(action, {
                method: 'POST',
                credentials: 'include'
            });
            
            if (response.ok || response.redirected) {
                // Ch·ªâ reload b·∫£ng d·ªØ li·ªáu (kh√¥ng reload to√†n trang)
                console.log("‚úÖ ƒê√£ x√≥a m·ªÅm employer, ƒëang reload b·∫£ng...");
                await window.filterEmployers();
                alert('ƒê√£ kh√≥a t√†i kho·∫£n th√†nh c√¥ng!');
            } else {
                alert('C√≥ l·ªói x·∫£y ra khi kh√≥a t√†i kho·∫£n.');
            }
        } catch (error) {
            console.error('‚ùå L·ªói khi x√≥a m·ªÅm employer:', error);
            alert('C√≥ l·ªói x·∫£y ra khi kh√≥a t√†i kho·∫£n.');
        }
        
        return false;
    };

    // H√†m l·ªçc employer - ch·ªâ load l·∫°i b·∫£ng d·ªØ li·ªáu
    // CH·ªà HO·∫†T ƒê·ªòNG KHI ƒêANG ·ªû TRANG EMPLOYER
    window.filterEmployers = async function() {
        // Ki·ªÉm tra xem c√≥ ƒëang ·ªü trang employer kh√¥ng
        const keywordEl = document.getElementById('keyword');
        const statusEl = document.getElementById('status');
        const dateFilterEl = document.getElementById('dateFilter');
        const tableBody = document.querySelector('.employer-table tbody');
        
        // N·∫øu kh√¥ng c√≥ c√°c elements n√†y, c√≥ nghƒ©a l√† ƒëang ·ªü trang kh√°c (nh∆∞ jobseeker)
        if (!keywordEl || !statusEl || !dateFilterEl || !tableBody) {
            // Kh√¥ng log error ƒë·ªÉ tr√°nh nh·∫ßm l·∫´n khi ·ªü trang kh√°c
            return;
        }
        
        const keyword = keywordEl.value || '';
        const status = statusEl.value || '';
        const dateFilter = dateFilterEl.value || '';
        
        // T·∫°o URL v·ªõi parameters cho API
        const params = new URLSearchParams();
        if (keyword.trim()) params.append('keyword', keyword.trim());
        if (status.trim()) params.append('status', status.trim());
        if (dateFilter.trim()) params.append('dateFilter', dateFilter.trim());
        params.append('page', currentPage);
        params.append('size', pageSize);
        
        const url = '/admin/api/employers/table' + (params.toString() ? '?' + params.toString() : '');
        
        // Hi·ªÉn th·ªã loading
        tableBody.innerHTML = `
            <tr>
                <td colspan="8" style="text-align:center; padding:20px; color:#888;">
                    <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i d·ªØ li·ªáu...
                </td>
            </tr>
        `;
        
        try {
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            const data = await response.json();
            console.log("‚úÖ Nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu employer:", data);
            
            // C·∫≠p nh·∫≠t pagination info
            totalResults = data.total || 0;
            currentPage = data.page || 1;
            totalPages = data.totalPages || 1;
            
            // Render l·∫°i b·∫£ng
            window.renderEmployerTable(data.employers || []);
            
            // Render pagination
            window.renderEmployerPagination();
            
        } catch (error) {
            console.error("‚ùå L·ªói khi l·ªçc employer:", error);
            tableBody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align:center; padding:20px; color:#dc3545;">
                        <i class="fas fa-exclamation-triangle"></i> L·ªói khi t·∫£i d·ªØ li·ªáu: ${error.message}
                    </td>
                </tr>
            `;
        }
    };

    // H√†m render b·∫£ng employer
    window.renderEmployerTable = function(employers) {
        const tableBody = document.querySelector('.employer-table tbody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        if (!employers || employers.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align:center; padding:20px; color:#888;">
                        Kh√¥ng c√≥ d·ªØ li·ªáu ph√π h·ª£p
                    </td>
                </tr>
            `;
            return;
        }
        
        employers.forEach(emp => {
            const row = document.createElement('tr');
            const createdAt = emp.createdAt ? emp.createdAt.split('T')[0] : '';
            
            row.innerHTML = `
                <td>${emp.companyName || ''}</td>
                <td>${emp.email || ''}</td>
                <td>${emp.phoneNumber || ''}</td>
                <td>${emp.industry || ''}</td>
                <td>${emp.location || ''}</td>
                <td>${createdAt}</td>
                <td>
                    <span class="status-${emp.status}">${emp.statusText}</span>
                </td>
                <td>
                    ${emp.status === 'inactive' ? 
                        `<button class="btn btn-sm btn-secondary" disabled style="cursor: not-allowed; opacity: 0.6;" title="Kh√¥ng th·ªÉ x√≥a t√†i kho·∫£n ƒë√£ kh√≥a">
                            <i class="fas fa-trash-alt"></i> X√≥a
                        </button>` :
                        `<form data-action="/admin/employer/${emp.userId}/soft-delete" class="soft-delete-form" style="display: inline-block;" onsubmit="return window.softDeleteEmployer(event, this);">
                            <button type="submit" class="btn btn-sm btn-danger" title="Kh√≥a t√†i kho·∫£n nh√† tuy·ªÉn d·ª•ng">
                                <i class="fas fa-trash-alt"></i> X√≥a
                            </button>
                        </form>`
                    }
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        console.log("‚úÖ ƒê√£ render", employers.length, "employer records");
    };

    // H√†m render pagination
    window.renderEmployerPagination = function() {
        const paginationInfo = document.getElementById("paginationInfo");
        const paginationControls = document.getElementById("paginationControls");
        const pageNumbers = document.getElementById("pageNumbers");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        if (!paginationInfo || !paginationControls) {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y pagination elements");
            return;
        }

        // C·∫≠p nh·∫≠t th√¥ng tin pagination
        const fromIndex = totalResults > 0 ? (currentPage - 1) * pageSize + 1 : 0;
        const toIndex = Math.min(currentPage * pageSize, totalResults);
        
        const fromIndexEl = document.getElementById("fromIndex");
        const toIndexEl = document.getElementById("toIndex");
        const totalResultsEl = document.getElementById("totalResults");
        
        if (fromIndexEl) fromIndexEl.textContent = fromIndex;
        if (toIndexEl) toIndexEl.textContent = toIndex;
        if (totalResultsEl) totalResultsEl.textContent = totalResults;

        // C·∫≠p nh·∫≠t n√∫t Previous/Next
        if (prevBtn) {
            prevBtn.disabled = currentPage <= 1;
            prevBtn.onclick = currentPage > 1 ? function() {
                currentPage--;
                window.filterEmployers();
            } : null;
        }

        if (nextBtn) {
            nextBtn.disabled = currentPage >= totalPages;
            nextBtn.onclick = currentPage < totalPages ? function() {
                currentPage++;
                window.filterEmployers();
            } : null;
        }

        // Render s·ªë trang
        if (!pageNumbers) {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y pageNumbers");
            return;
        }

        pageNumbers.innerHTML = "";

        if (totalPages <= 1) {
            // Ch·ªâ hi·ªÉn th·ªã trang 1 n·∫øu ch·ªâ c√≥ 1 trang
            const btn = document.createElement("button");
            btn.className = "pagination-btn active";
            btn.textContent = "1";
            btn.disabled = true;
            pageNumbers.appendChild(btn);
            return;
        }

        // Hi·ªÉn th·ªã t·ªëi ƒëa 7 n√∫t (bao g·ªìm ...)
        let startPage, endPage;
        
        if (totalPages <= 7) {
            // N·∫øu √≠t h∆°n 7 trang, hi·ªÉn th·ªã t·∫•t c·∫£
            startPage = 1;
            endPage = totalPages;
        } else {
            // N·∫øu nhi·ªÅu h∆°n 7 trang
            if (currentPage <= 4) {
                startPage = 1;
                endPage = 5;
            } else if (currentPage >= totalPages - 3) {
                startPage = totalPages - 4;
                endPage = totalPages;
            } else {
                startPage = currentPage - 2;
                endPage = currentPage + 2;
            }
        }

        // N√∫t ƒë·∫ßu ti√™n
        if (startPage > 1) {
            const btn = document.createElement("button");
            btn.className = "pagination-btn";
            btn.textContent = "1";
            btn.onclick = function() {
                currentPage = 1;
                window.filterEmployers();
            };
            pageNumbers.appendChild(btn);
            
            if (startPage > 2) {
                const dots = document.createElement("button");
                dots.className = "pagination-btn";
                dots.textContent = "...";
                dots.disabled = true;
                dots.style.cursor = "default";
                pageNumbers.appendChild(dots);
            }
        }

        // C√°c n√∫t trang
        for (let i = startPage; i <= endPage; i++) {
            const btn = document.createElement("button");
            btn.className = "pagination-btn";
            if (i === currentPage) {
                btn.classList.add("active");
            }
            btn.textContent = i;
            btn.onclick = function() {
                currentPage = i;
                window.filterEmployers();
            };
            pageNumbers.appendChild(btn);
        }

        // N√∫t cu·ªëi c√πng
        if (endPage < totalPages) {
            if (endPage < totalPages - 1) {
                const dots = document.createElement("button");
                dots.className = "pagination-btn";
                dots.textContent = "...";
                dots.disabled = true;
                dots.style.cursor = "default";
                pageNumbers.appendChild(dots);
            }
            
            const btn = document.createElement("button");
            btn.className = "pagination-btn";
            btn.textContent = totalPages;
            btn.onclick = function() {
                currentPage = totalPages;
                window.filterEmployers();
            };
            pageNumbers.appendChild(btn);
        }
    };

    // H√†m x√≥a b·ªô l·ªçc
    // CH·ªà HO·∫†T ƒê·ªòNG KHI ƒêANG ·ªû TRANG EMPLOYER
    window.clearFilters = async function() {
        const keywordEl = document.getElementById('keyword');
        const statusEl = document.getElementById('status');
        const dateFilterEl = document.getElementById('dateFilter');
        const tableBody = document.querySelector('.employer-table tbody');
        
        // N·∫øu kh√¥ng c√≥ c√°c elements n√†y, c√≥ nghƒ©a l√† ƒëang ·ªü trang kh√°c (nh∆∞ jobseeker)
        if (!keywordEl || !statusEl || !dateFilterEl || !tableBody) {
            // Kh√¥ng l√†m g√¨ c·∫£, return ngay
            return;
        }
        
        keywordEl.value = '';
        statusEl.value = '';
        dateFilterEl.value = '';
        currentPage = 1; // Reset v·ªÅ trang 1 khi clear filter
        
        // Load l·∫°i d·ªØ li·ªáu kh√¥ng c√≥ filter
        await window.filterEmployers();
    };

    // H√†m xu·∫•t Excel cho employer
    window.exportEmployersToExcel = function() {
        console.log("üì• ===== exportEmployersToExcel() ƒê∆Ø·ª¢C G·ªåI =====");
        
        // L·∫•y l·∫°i elements n·∫øu ch∆∞a c√≥
        const keywordEl = document.getElementById('keyword');
        const statusEl = document.getElementById('status');
        const dateFilterEl = document.getElementById('dateFilter');
        
        if (!keywordEl || !statusEl || !dateFilterEl) {
            console.error("‚ùå Kh√¥ng t√¨m th·∫•y filter elements");
            return;
        }
        
        try {
            // L·∫•y gi√° tr·ªã filter hi·ªán t·∫°i
            const keyword = keywordEl ? keywordEl.value.trim() : "";
            const status = statusEl ? statusEl.value : "";
            const dateFilter = dateFilterEl ? dateFilterEl.value : "";
            
            console.log("üìã Filter values:", { keyword, status, dateFilter });
            
            // T·∫°o URL v·ªõi parameters
            const params = new URLSearchParams();
            if (keyword) params.append("keyword", keyword);
            if (status) params.append("status", status);
            if (dateFilter) params.append("dateFilter", dateFilter);
            
            const url = `/admin/employer/export${params.toString() ? '?' + params.toString() : ''}`;
            console.log("üîó URL export:", url);
            
            // M·ªü URL ƒë·ªÉ download file
            window.location.href = url;
            console.log("‚úÖ ƒê√£ redirect ƒë·∫øn URL export");
        } catch (error) {
            console.error("‚ùå L·ªói khi x·ª≠ l√Ω export:", error);
            alert("L·ªói khi xu·∫•t Excel: " + error.message);
        }
    };

    // Ch·ªâ c·∫≠p nh·∫≠t th·ªëng k√™ ƒë·ªông (n·∫øu c·∫ßn) - d·ªØ li·ªáu ch√≠nh ƒë∆∞·ª£c render t·ª´ server
    window.updateEmployerStats = async function() {
        try {
            const response = await fetch("/admin/api/employers/stats", {
                method: 'GET',
                headers: { 'Accept': 'application/json' },
                credentials: 'include'
            });
            
            if (!response.ok) return;
            
            const data = await response.json();
            const statCards = document.querySelectorAll(".employer-stats .stat-card h3");
            
            if (statCards.length >= 4) {
                statCards[0].textContent = data.total || 0;
                statCards[1].textContent = data.active || 0;
                statCards[2].textContent = data.pending || 0;
                statCards[3].textContent = data.inactive || 0;
            }
        } catch (error) {
            console.error("‚ùå L·ªói khi c·∫≠p nh·∫≠t th·ªëng k√™:", error);
        }
    };

    // H√†m kh·ªüi t·∫°o event listeners (ch·ªâ ch·∫°y khi ƒëang ·ªü trang employer)
    function initEmployerFilters() {
        // Ki·ªÉm tra xem c√≥ ƒëang ·ªü trang employer kh√¥ng
        const filterBtn = document.getElementById('filterBtn');
        const clearBtn = document.getElementById('clearBtn');
        const keywordEl = document.getElementById('keyword');
        
        // N·∫øu kh√¥ng c√≥ c√°c elements ƒë·∫∑c tr∆∞ng c·ªßa employer page, th√¨ ƒëang ·ªü trang kh√°c
        if (!filterBtn || !clearBtn || !keywordEl) {
            return; // Kh√¥ng l√†m g√¨ c·∫£, tr√°nh ·∫£nh h∆∞·ªüng ƒë·∫øn trang kh√°c
        }
        
        if (filterBtn) {
            // X√≥a listener c≈© (n·∫øu c√≥) v√† th√™m m·ªõi
            const newFilterBtn = filterBtn.cloneNode(true);
            filterBtn.parentNode.replaceChild(newFilterBtn, filterBtn);
            newFilterBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                currentPage = 1; // Reset v·ªÅ trang 1 khi filter
                window.filterEmployers();
            });
        }
        
        if (clearBtn) {
            // X√≥a listener c≈© (n·∫øu c√≥) v√† th√™m m·ªõi
            const newClearBtn = clearBtn.cloneNode(true);
            clearBtn.parentNode.replaceChild(newClearBtn, clearBtn);
            newClearBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                window.clearFilters();
            });
        }
        
        // Th√™m event listener cho n√∫t Xu·∫•t Excel
        const exportBtn = document.getElementById('exportBtn');
        if (exportBtn) {
            const newExportBtn = exportBtn.cloneNode(true);
            exportBtn.parentNode.replaceChild(newExportBtn, exportBtn);
            newExportBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log("üì• ===== [addEventListener] N√öT XU·∫§T EXCEL ƒê∆Ø·ª¢C CLICK =====");
                if (typeof window.exportEmployersToExcel === 'function') {
                    console.log("‚úÖ G·ªçi window.exportEmployersToExcel() t·ª´ addEventListener...");
                    window.exportEmployersToExcel();
                } else {
                    console.error("‚ùå window.exportEmployersToExcel kh√¥ng t·ªìn t·∫°i trong addEventListener!");
                    alert("Ch·ª©c nƒÉng xu·∫•t Excel ch∆∞a s·∫µn s√†ng. Vui l√≤ng refresh trang.");
                }
                return false;
            });
        }

        // T·ª± ƒë·ªông load d·ªØ li·ªáu ban ƒë·∫ßu v√† render pagination
        setTimeout(function() {
            if (typeof window.filterEmployers === 'function') {
<!--                window.filterEmployers();-->
            }
        }, 100);
    }

    // Kh·ªüi t·∫°o khi DOM s·∫µn s√†ng (trang load tr·ª±c ti·∫øp)
    // CH·ªà CH·∫†Y KHI ƒêANG ·ªû TRANG EMPLOYER
    if (document.readyState === 'loading') {
        document.addEventListener("DOMContentLoaded", initEmployerFilters);
    } else {
        // DOM ƒë√£ s·∫µn s√†ng
        setTimeout(initEmployerFilters, 100);
    }

    // Event listener cho content ƒë∆∞·ª£c load qua AJAX
    // CH·ªà L·∫ÆNG NGHE KHI ƒêANG ·ªû TRANG EMPLOYER
    (function() {
        // Ki·ªÉm tra xem c√≥ ƒëang ·ªü trang employer kh√¥ng tr∆∞·ªõc khi l·∫Øng nghe
        const keywordEl = document.getElementById('keyword');
        if (!keywordEl) {
            // Kh√¥ng ph·∫£i trang employer, kh√¥ng l·∫Øng nghe
            return;
        }
        
        const contentAreaEl = document.getElementById('content-area');
        if (contentAreaEl) {
            contentAreaEl.addEventListener('contentLoaded', function(e) {
                // Ki·ªÉm tra l·∫°i xem c√≥ ƒëang ·ªü trang employer kh√¥ng
                const keywordCheck = document.getElementById('keyword');
                if (keywordCheck) {
                    // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ ƒë·∫£m b·∫£o DOM ƒë√£ update
                    setTimeout(initEmployerFilters, 100);
                }
            });
        } else {
            // N·∫øu contentArea ch∆∞a t·ªìn t·∫°i, th·ª≠ l·∫°i sau
            setTimeout(function() {
                const area = document.getElementById('content-area');
                if (area) {
                    area.addEventListener('contentLoaded', function(e) {
                        // Ki·ªÉm tra l·∫°i xem c√≥ ƒëang ·ªü trang employer kh√¥ng
                        const keywordCheck = document.getElementById('keyword');
                        if (keywordCheck) {
                            setTimeout(initEmployerFilters, 100);
                        }
                    });
                }
            }, 500);
        }
    })();
 </script>

</body>
</html>