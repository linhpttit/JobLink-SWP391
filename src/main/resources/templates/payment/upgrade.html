<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nâng cấp tài khoản - JobLink</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/CSS/payment-upgrade.css}">
</head>
<body>
    <!-- Include Header -->
    <div th:replace="~{header :: header}"></div>

    <div class="upgrade-container">
        <div class="upgrade-header">
            <h1><i class="fas fa-crown"></i> Nâng cấp tài khoản</h1>
            <p>Chọn gói phù hợp để mở rộng cơ hội tuyển dụng của bạn</p>
            
            <!-- Current Tier Info -->
            <div class="current-tier-info" th:if="${currentTier != null}">
                <div class="tier-badge" th:classappend="${currentTier == 1 ? 'basic' : (currentTier == 2 ? 'premium' : 'enterprise')}">
                    <i class="fas fa-medal"></i>
                    <span>Tier hiện tại: 
                        <strong th:text="${currentTier == 1 ? 'Basic' : (currentTier == 2 ? 'Premium' : 'Enterprise')}">Basic</strong>
                    </span>
                </div>
                <div class="expiry-info" th:if="${subscriptionExpiresAt != null}">
                    <i class="far fa-calendar-alt"></i>
                    <span th:if="${isSubscriptionActive}">
                        Hết hạn: <strong th:text="${#temporals.format(subscriptionExpiresAt, 'dd/MM/yyyy HH:mm')}">01/01/2025</strong>
                    </span>
                    <span th:unless="${isSubscriptionActive}" style="color: #e74c3c;">
                        Đã hết hạn: <strong th:text="${#temporals.format(subscriptionExpiresAt, 'dd/MM/yyyy HH:mm')}">01/01/2025</strong>
                    </span>
                </div>
            </div>
        </div>

        <!-- Error/Success Messages -->
        <div class="alert alert-danger" th:if="${error}" th:text="${error}"></div>
        <div class="alert alert-success" th:if="${success}" th:text="${success}"></div>

        <!-- Packages Grid -->
        <div class="packages-grid">
            <div class="package-card" th:each="package : ${packages}" 
                 th:classappend="${package.tierLevel == 2 ? 'featured' : ''}">
                
                <div class="popular-badge" th:if="${package.tierLevel == 2}">
                    <i class="fas fa-star"></i> PHỔ BIẾN NHẤT
                </div>

                <div class="package-header">
                    <div class="tier-icon" th:classappend="${package.tierLevel == 1 ? 'basic' : (package.tierLevel == 2 ? 'premium' : 'enterprise')}">
                        <i class="fas" th:classappend="${package.tierLevel == 1 ? 'fa-briefcase' : (package.tierLevel == 2 ? 'fa-gem' : 'fa-trophy')}"></i>
                    </div>
                    <h2 th:text="${package.packageName}">Premium</h2>
                    <p class="package-description" th:text="${package.description}">Dành cho doanh nghiệp vừa</p>
                </div>

                <div class="package-price">
                    <span class="price-amount" th:text="${#numbers.formatDecimal(package.price, 0, 'COMMA', 0, 'POINT')}">499,000</span>
                    <span class="price-currency">đ</span>
                    <span class="price-period" th:text="'/' + ${package.durationDays} + ' ngày'">/ 30 ngày</span>
                </div>

                <div class="package-features">
                    <h3>Tính năng nổi bật:</h3>
                    <ul>
                        <li th:if="${package.tierLevel >= 1}">
                            <i class="fas fa-check"></i> Đăng tối đa <strong th:text="${package.tierLevel == 1 ? '5' : (package.tierLevel == 2 ? '20' : '100')}">20</strong> tin tuyển dụng
                        </li>
                        <li th:if="${package.tierLevel >= 1}">
                            <i class="fas fa-check"></i> Xem hồ sơ ứng viên
                        </li>
                        <li th:if="${package.tierLevel >= 2}">
                            <i class="fas fa-check"></i> <strong>Tin nổi bật</strong> trên trang chủ
                        </li>
                        <li th:if="${package.tierLevel >= 2}">
                            <i class="fas fa-check"></i> <strong>Ưu tiên hiển thị</strong> trong kết quả tìm kiếm
                        </li>
                        <li th:if="${package.tierLevel >= 2}">
                            <i class="fas fa-check"></i> Thống kê chi tiết
                        </li>
                        <li th:if="${package.tierLevel >= 3}">
                            <i class="fas fa-check"></i> <strong>Hỗ trợ VIP 24/7</strong>
                        </li>
                        <li th:if="${package.tierLevel >= 3}">
                            <i class="fas fa-check"></i> <strong>AI tìm kiếm ứng viên</strong> phù hợp
                        </li>
                        <li th:if="${package.tierLevel >= 3}">
                            <i class="fas fa-check"></i> Quản lý đa chi nhánh
                        </li>
                    </ul>
                </div>

                <form th:action="@{/payment/create}" method="post" class="upgrade-form">
                    <input type="hidden" name="packageId" th:value="${package.packageId}">
                    <button type="submit" class="btn-upgrade" 
                            th:classappend="${package.tierLevel == 2 ? 'featured' : ''}"
                            th:disabled="${currentTier >= package.tierLevel && isSubscriptionActive}">
                        <span th:if="${currentTier < package.tierLevel || !isSubscriptionActive}">
                            <i class="fas fa-rocket"></i> Nâng cấp ngay
                        </span>
                        <span th:if="${currentTier >= package.tierLevel && isSubscriptionActive}">
                            <i class="fas fa-check-circle"></i> Đang sử dụng
                        </span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Payment Methods -->
        <div class="payment-methods">
            <h3><i class="fas fa-credit-card"></i> Phương thức thanh toán</h3>
            <div class="methods-grid">
                <div class="method-item">
                    <img src="https://cdn.haitrieu.com/wp-content/uploads/2022/10/Logo-VNPAY-QR.png" alt="VNPay">
                </div>
                <div class="method-item">
                    <i class="fas fa-university"></i>
                    <span>Ngân hàng nội địa</span>
                </div>
                <div class="method-item">
                    <i class="fas fa-credit-card"></i>
                    <span>Visa/Master</span>
                </div>
                <div class="method-item">
                    <i class="fas fa-qrcode"></i>
                    <span>QR Code</span>
                </div>
            </div>
        </div>

        <!-- FAQ Section -->
        <div class="faq-section">
            <h3><i class="fas fa-question-circle"></i> Câu hỏi thường gặp</h3>
            <div class="faq-item">
                <strong>Q: Thanh toán có an toàn không?</strong>
                <p>A: Chúng tôi sử dụng cổng thanh toán VNPay - đảm bảo 100% an toàn và bảo mật.</p>
            </div>
            <div class="faq-item">
                <strong>Q: Tôi có thể hủy gói đã mua không?</strong>
                <p>A: Gói đã thanh toán không thể hoàn tiền. Vui lòng cân nhắc kỹ trước khi thanh toán.</p>
            </div>
            <div class="faq-item">
                <strong>Q: Gói sẽ tự động gia hạn không?</strong>
                <p>A: Không, gói sẽ hết hạn sau thời gian quy định và bạn cần gia hạn thủ công.</p>
            </div>
        </div>
    </div>

    <!-- Include Footer -->
    <div th:replace="~{footer :: footer}"></div>
</body>
</html>
