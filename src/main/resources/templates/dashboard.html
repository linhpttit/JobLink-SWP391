<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý nhà tuyển dụng</title>
    <link rel="stylesheet" href="/CSS/dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="admin-container">


    <div class="admin-content">

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Content -->
            <section id="dashboard" class="content-section active">
                <div class="dashboard-header">
                    <h2><i class="fas fa-tachometer-alt"></i> Tổng quan hệ thống</h2>
                </div>


                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card">z
                        <div class="stat-icon user-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Tổng người dùng</h3>
                            <p class="stat-number"><b th:text="${totalUsers}"></b></p>
<!--                            <span th:class="'stat-change ' + (${userGrowth} >= 0 ? 'positive' : 'negative')">-->
<!--                                <i th:class="${userGrowth} >= 0 ? 'fas fa-arrow-up' : 'fas fa-arrow-down'"></i>-->
<!--                                <span th:text="${#numbers.formatDecimal(userGrowth, 1, 2)} + '%'"></span>-->
<!--                            </span>-->
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon jobseeker-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Người tìm việc</h3>
                            <p class="stat-number"><b th:text="${jobSeekers}"></b></p>
<!--                            <span th:class="'stat-change ' + (${userGrowth} >= 0 ? 'positive' : 'negative')">-->
<!--                                <i th:class="${jobSeekerGrowth} >= 0 ? 'fas fa-arrow-up' : 'fas fa-arrow-down'"></i>-->
<!--                                <span th:text="${#numbers.formatDecimal(jobSeekerGrowth, 1, 2)} + '%'"></span>-->
<!--                            </span>-->
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon employer-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Nhà tuyển dụng</h3>
                            <p class="stat-number"><b th:text="${employers}"></b></p>
<!--                            <span class="stat-change positive">-->
<!--                                    <i class="fas fa-arrow-up"></i> 0%-->
<!--                                </span>-->
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon job-icon">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Tin tuyển dụng</h3>
                            <p class="stat-number"><b th:text="${jobPosts}"></b></p>
<!--                            <span class="stat-change positive">-->
<!--                                    <i class="fas fa-arrow-up"></i> 0%-->
<!--                                </span>-->
                        </div>
                    </div>


                    <div class="stat-card">
                        <div class="stat-icon application-icon">
                            <i class="fas fa-file-signature"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Đơn ứng tuyển</h3>
                            <p class="stat-number"><b th:text="${applications}"></b></p>
<!--                            <span class="stat-change positive">-->
<!--                                    <i class="fas fa-arrow-up"></i> 0%-->
<!--                                </span>-->
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon revenue-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Doanh thu</h3>
                            <p class="stat-number"><b th:text="${revenue}"> VND</b></p>
<!--                            <span class="stat-change positive">-->
<!--                                    <i class="fas fa-arrow-up"></i> 0%-->
<!--                                </span>-->
                        </div>
                    </div>
                </div>

                <!-- CHARTS SECTION -->
                <div class="charts-container">
                    <!-- Biểu đồ Ứng tuyển -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-line"></i> Thống kê ứng tuyển</h3>
                            <div class="chart-legend">
                <span class="legend-item">
                    <i class="fas fa-square" style="color: #5953F5"></i> Ứng tuyển
                </span>
                                <span class="legend-item">
                    <i class="fas fa-square" style="color: #FF6B6B"></i> Được chấp nhận
                </span>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="applicationsChart"></canvas>
                        </div>
                    </div>

                    <!-- Biểu đồ người dùng -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-pie"></i> Phân loại người dùng</h3>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="usersChart"></canvas>
                        </div>
                    </div>
                </div>


                <!-- Recent Activity & Top Companies -->
                <!-- <div class="content-grid">
                    <div class="activity-card">
                        <div class="card-header">
                            <h3><i class="fas fa-clock"></i> Hoạt động gần đây</h3>
                            <button class="view-all-btn">Xem tất cả</button>
                        </div>
                        <div class="activity-list">
                            <div class="activity-item">
                                <div class="activity-icon success">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="activity-content">
                                    <p>Đã duyệt tin tuyển dụng</p>
                                    <span class="activity-time">10 phút trước</span>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="activity-content">
                                    <p>Tài khoản nhà tuyển dụng bị khóa</p>
                                    <span class="activity-time">2 giờ trước</span>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon info">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="activity-content">
                                    <p>Đã thêm gói dịch vụ Premium mới</p>
                                    <span class="activity-time">5 giờ trước</span>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon primary">
                                    <i class="fas fa-plus-circle"></i>
                                </div>
                                <div class="activity-content">
                                    <p>50 người dùng mới đăng ký trong ngày</p>
                                    <span class="activity-time">Hôm nay</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="companies-card">
                        <div class="card-header">
                            <h3><i class="fas fa-crown"></i> Top công ty tích cực</h3>
                        </div>
                        <div class="companies-list">
                            <div class="company-item">
                                <div class="company-rank">1</div>
                                <div class="company-info">
                                    <h4>TechCorp Vietnam</h4>
                                    <p>15 tin đăng • 245 ứng tuyển</p>
                                </div>
                                <div class="company-rating">
                                    <i class="fas fa-star"></i> 4.8
                                </div>
                            </div>
                            <div class="company-item">
                                <div class="company-rank">2</div>
                                <div class="company-info">
                                    <h4>SoftTech Solutions</h4>
                                    <p>12 tin đăng • 189 ứng tuyển</p>
                                </div>
                                <div class="company-rating">
                                    <i class="fas fa-star"></i> 4.7
                                </div>
                            </div>
                            <div class="company-item">
                                <div class="company-rank">3</div>
                                <div class="company-info">
                                    <h4>Digital Innovation</h4>
                                    <p>10 tin đăng • 156 ứng tuyển</p>
                                </div>
                                <div class="company-rating">
                                    <i class="fas fa-star"></i> 4.6
                                </div>
                            </div>
                        </div>
                    </div>
                </div> -->
            </section>
        </main>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    (function() {
        function createCharts() {
            const totalApplications = /*[[${totalApplications}]]*/ 0;
            const acceptedApplications = /*[[${acceptedApplications}]]*/ 0;
            const jobSeekers = /*[[${jobSeekers}]]*/ 0;
            const employers = /*[[${employers}]]*/ 0;
            const admins = /*[[${admins}]]*/ 0;

            const appsCanvas = document.getElementById('applicationsChart');
            const usersCanvas = document.getElementById('usersChart');
            if (!window.Chart) return;

            window.__dashboardCharts = window.__dashboardCharts || {};

            if (appsCanvas) {
                const container = appsCanvas.parentElement;
                if (container) { container.style.height = '500px'; container.style.width = '600px'; }
                if (window.__dashboardCharts.apps) {
                    try { window.__dashboardCharts.apps.destroy(); } catch (e) {}
                }
                window.__dashboardCharts.apps = new Chart(appsCanvas, {
                    type: 'bar',
                    data: {
                        labels: ['Thống kê ứng tuyển'],
                        datasets: [
                            { label: 'Tổng số Ứng tuyển', data: [totalApplications], backgroundColor: '#5953F5' },
                            { label: 'Được chấp nhận', data: [acceptedApplications], backgroundColor: '#FF6B6B' }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Số lượng' } },
                            x: { title: { display: true, text: 'Loại thống kê' } }
                        }
                    }
                });
            }

            if (usersCanvas) {
                const container = usersCanvas.parentElement;
                if (container) { container.style.height = '480px'; container.style.width = '400px'; }
                if (window.__dashboardCharts.users) {
                    try { window.__dashboardCharts.users.destroy(); } catch (e) {}
                }
                window.__dashboardCharts.users = new Chart(usersCanvas, {
                    type: 'pie',
                    data: {
                        labels: ['Người tìm việc', 'Nhà tuyển dụng', 'Admin'],
                        datasets: [{
                            data: [jobSeekers, employers, admins],
                            backgroundColor: ['#36A2EB', '#FFCE56', '#FF6384'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom', labels: { padding: 20 } },
                            title: { display: true, text: 'Phân bổ người dùng' }
                        }
                    }
                });
            }
        }

        // Initial render now
        if (window.Chart) {
            createCharts();
        } else {
            setTimeout(createCharts, 0);
        }

        // Re-render when navigating back to dashboard via SPA loader
        document.addEventListener('contentLoaded', function(e) {
            if (e && e.detail && e.detail.url && e.detail.url.indexOf('/admin/dashboard') !== -1) {
                createCharts();
            }
        });
    })();
</script>

</body>
</html>